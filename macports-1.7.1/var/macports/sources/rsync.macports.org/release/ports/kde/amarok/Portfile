# $Id: Portfile 47748 2009-03-05 03:25:52Z illogic-al@macports.org $

PortSystem          1.0
PortGroup           kde4   1.0

name                amarok
version             2.0.1.1
revision            1
categories          kde kde4
maintainers         illogic-al openmaintainer
description         Amarok, the world renown media player/.
long_description    Amarok is a music player and manager with an intuitive \
                    interface. It provides a variety of features which \
                    help you to discover and manage your music.
platforms           darwin
homepage            http://amarok.kde.org
master_sites	    kde:stable/${name}/${version}/src/
distfiles           ${name}-${version}-mac.tar.bz2
use_bzip2           yes
checksums           md5 881ae12942aa146bc08cca7db2501802

depends_lib-append  port:kdelibs4 \
                    port:kdebase4-runtime \
                    port:taglib-devel \
                    port:libmp4v2 \
                    path:lib/mysql5/libmysqld.a:mysql5-devel

post-extract { 
    reinplace \
    "s|macro_optional_add_subdirectory( po )|#macro_optional_add_subdirectory( po )|" \
    ${workpath}/${distname}/CMakeLists.txt
}

pre-configure {
    if { ![file exists ${prefix}/lib/mysql5/mysql/libmysqld.a] } {
        ui_error "mysql5-devel needs to be built with the +embedded_server variant"
        error "mysql5-devel needs to be built with the +embedded_server variant"
    }
}

configure.args-append	../${distname} \
						-DPHONON_INCLUDE_DIR=${prefix}/include \
						-DPHONON_LIBRARY=${prefix}/lib/libphonon.dylib

post-destroot {
    # This puts the bundle icons where they should go
	system "mv ${destroot}/${prefix}/bin/amarok.app/Contents/Resources/amarok.icns ${destroot}/${applications_dir}/KDE4/Amarok.app/Contents/Resources/"
	system "rm -rf ${destroot}/${prefix}/bin"
}

