# $Id: Portfile 42724 2008-11-30 00:50:57Z toby@macports.org $

PortSystem 1.0
name			arm-apple-darwin-cc
version			r118
revision		2
categories		iphone
maintainers		landonf@macports.org openmaintainer
description		Cross-compiler (driver) for arm-apple-darwin (iPhone)
long_description	${description}

homepage		http://developer.berlios.de/projects/iphone-binutils/
platforms		darwin

master_sites		http://landonf.bikemonkey.org/static/iphone/
distname		iphone-binutils-$version
checksums		md5 111b11f80fe535b3beb3d40633962f3b
depends_run		port:arm-apple-darwin-binutils \
			port:llvm-gcc42 \
			port:llvm

patchfiles		patch-Makefile.in \
			patch-driver_Makefile.in \
			patch-driver_arm-cc-specs.in \
			patch-libtool-driver

set iphone_prefix       ${prefix}/arm-apple-darwin

configure.args		--prefix=${iphone_prefix} --with-heavenly=${iphone_prefix}/heavenly

build.target		driver
build.args		DESTDIR=${destroot}

# Work-around the experimental destroot validation
destroot.violate_mtree	yes

post-patch {
	reinplace s|@MACPORTS_PREFIX@|${prefix}|g ${worksrcpath}/driver/arm-cc-specs.in
}

pre-build {
	file mkdir ${destroot}/${iphone_prefix}/bin
}

post-destroot {
	# Make the binaries externally visible.
	system "cd ${destroot}${prefix}/bin && ln -s ${iphone_prefix}/bin/arm-apple-darwin-cc ./"

	# Set up non-prefixed binaries in the iphone bin directory
	system "cd ${destroot}/${iphone_prefix}/bin && ln -s arm-apple-darwin-cc cc"
}
