# $Id: Portfile 34910 2008-03-11 02:48:25Z jmr@macports.org $

PortSystem			1.0
name				sudo
version				1.6.9p14
set base_version		${version}
categories			sysutils security
maintainers			nomaintainer
description			Allow users to run programs as other users, eg, root
long_description \
	Sudo is a program designed to allow a sysadmin to give limited root \
	privileges to users and log root activity.  The basic philosophy is to \
	give as few privileges as possible but still allow people to get their \
	work done.

platforms			darwin sunos freebsd

homepage			http://www.sudo.ws/sudo/
master_sites		${homepage}dist/ \
					${homepage}dist/OLD/
patch_sites		${master_sites}

distfiles		${name}-${base_version}.tar.gz

checksums \
	${name}-${base_version}.tar.gz \
		md5 a274767d74e99bdd86ebef4e9899a246 \
		sha1 71ac10f51c1b3d6338ac936fe39be3009ea4dbb4 \
		rmd160 8516c9f0a6468e07174ffda310f55013841e3fba

worksrcdir		${name}-${base_version}
patch.dir		${workpath}
configure.args		--infodir=${prefix}/share/info \
					--mandir=${prefix}/share/man \
					--sysconfdir=${prefix}/etc \
					--with-env-editor \
					--with-tty-tickets \
					--with-ignore-dot \
					--with-timedir=${prefix}/var/run/sudo \
					--disable-log-wrap

pre-destroot {
	if { $env(USER) != "root" } {
		ui_msg "------------------------------------------------------------"
		ui_msg "Installing sudo as non-root doesn't really do anything"
		ui_msg "useful, so be sure to install sudo as root"
		ui_msg "------------------------------------------------------------"
	}
}

post-destroot {
	file rename ${destroot}${prefix}/etc/sudoers ${destroot}${prefix}/etc/sudoers.dist
}

post-install {
	ui_msg "------------------------------------------------------------"
	ui_msg "To complete installation, copy, as root, "
	ui_msg "${prefix}/etc/sudoers.dist to ${prefix}/etc/sudoers (keeping "
	ui_msg "the same permissions), and edit it as necessary (see the"
	ui_msg "sudoers manpage for information)."
	ui_msg "------------------------------------------------------------"
}

platform darwin {
	configure.args-append	--with-password-timeout=0 \
							--with-pam
}

platform sunos {
	configure.args-append	--with-pam
}

platform freebsd {
	configure.args-append	--with-pam \
							--with-logincap \
							--with-long-otp-prompt
}

variant insults {
	configure.args-append	--with-insults --with-all-insults
}

