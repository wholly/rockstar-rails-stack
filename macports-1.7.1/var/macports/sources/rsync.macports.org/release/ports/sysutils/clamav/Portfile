# $Id: Portfile 49705 2009-04-15 17:30:28Z dluke@macports.org $

PortSystem 1.0

name			clamav
version		 	0.95.1
categories	  	sysutils
maintainers	 	dluke@geeklair.net
description	 	clamav antivirus software

long_description	Clam AntiVirus is a GPL anti-virus toolkit for UNIX. The \
			main purpose of this software is the integration with mail \
			servers (attachment scanning).
			
homepage		http://www.clamav.net
master_sites		sourceforge
checksums	md5	c802d4b372e455849cfcb0d776fc72d8 \
		sha1	a469b0128cf5e9d18392a0385417fc5e4575bfc7 \
		rmd160	80769c09ca15c864a578206feabe9cc4a3d985b4
platforms	   	darwin
configure.args  	--disable-clamav \
			--mandir=${prefix}/share/man \
			--with-zlib=${prefix}

use_parallel_build	yes

depends_lib		port:gmp port:libiconv port:zlib port:bzip2

platform darwin 7 {
			patchfiles patch-clamdtop.c.diff
			#workaround gcc bug 28045 http://gcc.gnu.org/bugzilla/show_bug.cgi?id=28045
			configure.cflags {-O0}
			}

platform darwin 8 {
			configure.cflags {-O0}
		}

post-destroot {
			system "cd '${destroot}${prefix}/etc/'
			mv freshclam.conf example-freshclam.conf
			mv clamd.conf example-clamd.conf"
			}

post-install {		ui_msg "\nYou need to add a new clamav user and clamav\
				group to your system if you want to use clamav\
				in superuser mode.\n"
			}

variant clamav_milter description {build with libmilter support} {
			depends_lib-append port:libmilter
			configure.args-append --enable-milter
			}
