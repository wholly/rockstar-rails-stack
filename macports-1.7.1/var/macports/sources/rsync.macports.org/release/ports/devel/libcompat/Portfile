# $Id: Portfile 34430 2008-02-24 20:19:47Z pguyot@kallisys.net $

PortSystem 1.0

name		libcompat
version		4.6.2-RELEASE
revision	1
categories	devel
maintainers	nomaintainer
description	Compatibility library with functionality from 4BSD
#homepage
platforms	darwin
use_bzip2	yes
master_sites	macports
checksums	md5 4e0ddeec2be3a2c8caf24a3ed51b8501
build.type	bsd
worksrcdir	${name}
use_configure	no
patchfiles	patch-Makefile \
			patch-4.3-regex.c
build.env	LDADD="-install_name ${prefix}/lib/libcompat.1.dylib"

# Copy regexp.h for compilation of libcompat.
post-patch {
	file copy "${portpath}/${filesdir}/regexp.h" "${worksrcpath}/4.3/"
}

pre-build {
	# You need BSD tsort (/usr/bin), not GNU tsort (from GNU coreutils)
	# see Bug: http://trac.macports.org/projects/macports/ticket/12373
	system "COREUTILS=`tsort --version 2>/dev/null | grep coreutils`; \
	if \[ \"x\$COREUTILS\" != \"x\" \]; then echo \$COREUTILS; exit 1; fi"
}

destroot	{
	file copy ${worksrcpath}/libcompat.1.dylib ${destroot}${prefix}/lib
	system "cd ${worksrcpath} && ln -sf libcompat.1.dylib \
		${destroot}${prefix}/lib/libcompat.dylib"
	
	# Copy regexp.h
	file copy "${portpath}/${filesdir}/regexp.h" "${destroot}${prefix}/include/"
}

variant universal {
	build.env \
		CFLAGS="${configure.universal_cflags}" \
		LDADD="${configure.universal_ldflags} -install_name ${prefix}/lib/libcompat.1.dylib"
}
