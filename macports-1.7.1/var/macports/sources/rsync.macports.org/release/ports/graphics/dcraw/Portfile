# $Id: Portfile 47944 2009-03-10 21:40:20Z ryandesign@macports.org $

PortSystem              1.0

name                    dcraw
version                 8.93
set distfile_date       20090309212000
categories              graphics
maintainers             ryandesign
platforms               darwin
homepage                http://www.cybercom.net/~dcoffin/dcraw/
master_sites            ${homepage}archive/
worksrcdir              $name
dist_subdir             ${name}/${version}-${distfile_date}
use_parallel_build      yes

description \
    Raw Digital Photo Decoding, supporting 209 cameras

long_description \
    ${description}

checksums \
    md5     1ca10ba4be66962f976163c294e58579 \
    sha1    fd30851c77c8476997f15a637e96ed3bbeffa609 \
    rmd160  27321cc03b04b1aee3042433d0317e079ed65a6e

depends_lib \
    port:gettext \
    port:libiconv \
    port:jpeg \
    port:lcms

post-extract {
    xinstall -W ${filespath} Makefile.in ${worksrcpath}/Makefile
}

configure {
    reinplace "s|@CC@|${configure.cc}|g" ${worksrcpath}/Makefile
    reinplace "s|@CFLAGS@|${configure.cflags}|g" ${worksrcpath}/Makefile
    reinplace "s|@CPPFLAGS@|${configure.cppflags}|g" ${worksrcpath}/Makefile
    reinplace "s|@LDFLAGS@|${configure.ldflags}|g" ${worksrcpath}/Makefile
    reinplace "s|@PREFIX@|${prefix}|g" ${worksrcpath}/Makefile
}

set my_locales          {eo ru fr it de pt es zh_TW zh_CN nl pl hu ca cs sv}

post-destroot {
    xinstall -m 644 -W ${worksrcpath} dcraw.1 ${destroot}${prefix}/share/man/man1
    foreach locale ${my_locales} {
        if {[file exist ${worksrcpath}/dcraw_${locale}.1]} {
            xinstall -m 755 -d ${destroot}${prefix}/share/man/${locale}/man1
            xinstall -m 644 -W ${worksrcpath} dcraw_${locale}.1 ${destroot}${prefix}/share/man/${locale}/man1/dcraw.1
        }
        if {[file exist ${worksrcpath}/build/dcraw_${locale}.mo]} {
            xinstall -m 755 -d ${destroot}${prefix}/share/locale/${locale}/LC_MESSAGES
            xinstall -m 644 -W ${worksrcpath}/build dcraw_${locale}.mo ${destroot}${prefix}/share/locale/${locale}/LC_MESSAGES/dcraw.mo
        }
    }
}

pre-activate {
    ui_msg "This port conflicts with ufraw. If this port fails to"
    ui_msg "activate, uninstall or deactivate ufraw and attempt to"
    ui_msg "activate this port again."
}

livecheck.version       ${version}-${distfile_date}
livecheck.check         regex
livecheck.url           http://www.ryandesign.com/macports/version.php/${name}
livecheck.regex         (.*)
