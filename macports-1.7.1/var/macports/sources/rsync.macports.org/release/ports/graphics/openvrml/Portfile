# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 48666 2009-03-26 23:49:18Z devans@macports.org $

PortSystem              1.0

name                    openvrml
version                 0.17.12
categories              graphics x11
maintainers             ira.uka.de:raphael openmaintainer
description             a cross-platform VRML and X3D browser and C++ runtime \
                        library
long_description        OpenVRML is a free cross-platform runtime for VRML and \
                        X3D available under the GNU Lesser General Public \
                        License. The OpenVRML distribution includes libraries \
                        you can use to add VRML/X3D support to an application. \
                        On platforms where GTK+ is available, OpenVRML also \
                        provides a plug-in to render VRML/X3D worlds in Web \
                        browsers.
homepage                http://www.openvrml.org/
platforms               darwin
master_sites            sourceforge
checksums               md5     162153ee2e5c498b31f600193ebabe58 \
                        sha1    e546b089214b1e6d50f57e524db8991930032618 \
                        rmd160  c6a4aee4cef82490efc27bb510c8d21da10029e4

depends_lib             port:boost \
                        port:libpng \
                        port:jpeg \
                        port:fontconfig \
                        port:mesa \
                        port:libsdl
depends_build           port:pkgconfig

pre-extract {           if {"darwin" == ${os.platform} && 9 == ${os.major}} {
                            set minimum_xcodeversion 3.1
                            set current_xcodeversion [exec defaults read /Developer/Applications/Xcode.app/Contents/Info CFBundleShortVersionString]
                            if {[rpm-vercomp ${current_xcodeversion} ${minimum_xcodeversion}] < 0} {
                                ui_msg "On Mac OS X ${macosx_version}, ${name} ${version} requires Xcode ${minimum_xcodeversion} or later but you have Xcode ${current_xcodeversion}."
                                return -code error "incompatible Xcode version"
                            }
                        }
}

configure.args          --disable-script-node-javascript \
                        --disable-xembed \
                        --disable-player \
                        --disable-mozilla-plugin \
                        --with-x \
                        --x-includes=${prefix}/include \
                        --x-libraries=${prefix}/lib
configure.env-append    BOOST_LIB_SUFFIX=-mt

# For +system_x11 variant
if { ![file exists ${prefix}/lib/pkgconfig/gl.pc] } {
        configure.args-delete --x-includes=${prefix}/include \
                              --x-libraries=${prefix}/lib
}

use_parallel_build      yes

variant js_mozilla description {Enable support for JavaScript in the Script node with Mozilla} {
    depends_lib-append          port:mozilla
    configure.args-delete       --disable-script-node-javascript
}

variant no_opengl conflicts xembed description {Do not build the GL renderer} {
    depends_lib-delete          port:mesa
    configure.args-append       --disable-gl-renderer
}

variant xembed conflicts no_opengl description {Build the XEmbed control} {
    depends_lib-append          port:gtk2 \
                                port:dbus-glib
    configure.args-delete       --disable-xembed
}

variant player requires xembed description {Build the GNOME openvrml-player} {
    depends_lib-append          port:libgnomeui \
                                port:curl
    configure.args-delete       --disable-player
}

variant mozilla_plugin requires xembed description {Build the Mozilla plug-in} {
    depends_lib-append          port:mozilla
    configure.args-delete       --disable-mozilla-plugin
}

variant no_x11 description {
    configure.args-delete       --with-x
    configure.args-append       --without-x
}
