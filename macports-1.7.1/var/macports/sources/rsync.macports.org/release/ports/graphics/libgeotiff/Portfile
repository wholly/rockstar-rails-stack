# $Id: Portfile 41470 2008-11-04 02:48:27Z blb@macports.org $

PortSystem 1.0
name		libgeotiff
version		1.2.1
set libver	1
categories	graphics
maintainers	shadow@dementia.org
description	Library and tools for dealing with GeoTIFF
long_description This software provides support for the Tag Image File \
		 Format (TIFF) Geo extensions.
homepage	http://www.remotesensing.org/geotiff/
platforms	darwin
master_sites	ftp://ftp.remotesensing.org/pub/geotiff/libgeotiff/
distname	${name}-${version}
checksums	md5 cd02f28915f964e4aa914e0e1b39ab4b

patchfiles 	patch-incode

depends_lib	lib:libtiff.3.6:tiff lib:libproj.0:proj lib:libz.1:zlib

configure.env	MANPATH=${prefix}/share/man

configure.args	--with-zip=${prefix} --with-jpeg=${prefix} \
                --with-proj=${prefix} --enable-incode-epsg

destroot.destdir
build.env	DESTDIR=${destroot}
destroot.env	DESTDIR=${destroot}

post-build	{ system "cd ${worksrcpath} && cc -dynamiclib -all_load \
		  -install_name ${prefix}/lib/libgeotiff.${version}.dylib \
		  -compatibility_version ${version} \
		  -o libgeotiff.${version}.dylib libgeotiff.a -L${prefix}/lib \
		  -lproj -ltiff -ljpeg -lz" }

pre-destroot	"file mkdir ${destroot}/${prefix}"

post-destroot	{ delete ${destroot}${prefix}/lib/libgeotiff.a
		  xinstall -m 755 -d ${destroot}${prefix}/lib
		  xinstall -m 644 -W ${worksrcpath} \
		    libgeotiff.${version}.dylib \
		    ${destroot}${prefix}/lib
		  ln -sf libgeotiff.${version}.dylib \
		    ${destroot}${prefix}/lib/libgeotiff.${libver}.dylib
		  ln -sf libgeotiff.${version}.dylib \
		    ${destroot}${prefix}/lib/libgeotiff.dylib }
