# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id: Portfile 49424 2009-04-09 12:32:49Z alakazam@macports.org $

PortSystem 1.0

name                octave
version             3.0.5
categories          math science
maintainers         alakazam stechert
platforms           darwin
description         a Matlab-like environment for numerical analysis
long_description    Octave provides a convenient command line interface \
                    for solving linear and nonlinear problems numerically, \
                    using a language that is mostly compatible with Matlab. \
                    It is easily extensible and customizable via \
                    user-defined functions or using dynamically loaded \
                    modules written in e.g. C++, C or Fortran.

homepage            http://www.gnu.org/software/octave/
master_sites        ftp://ftp.gnu.org/pub/gnu/octave/

use_bzip2           no
checksums           md5     b88305f7e093ab78487d86d853320835 \
                    sha1    35333ba4b4807428804ca08b8f7c50f4b51ffd47 \
                    rmd160  9fba1cbf599f1d2d4dc9c7ebb9f19dd807e51612

depends_build       port:gawk \
                    port:gsed \
                    path:bin/perl:perl5 \
                    port:texinfo

depends_lib         port:readline \
                    port:curl \
                    port:hdf5 \
                    port:fftw-3 \
                    port:metis \
                    port:SuiteSparse \
                    port:pcre \
                    port:glpk \
                    port:gnuplot \
                    port:ncurses \
                    port:qhull

configure.args      --enable-shared \
                    --enable-dl \
                    --disable-static \
                    --with-hdf5 \
                    --with-fftw \
                    --with-blas="-framework Accelerate" \
                    --enable-static \
                    --enable-readline \
                    --with-zlib \
                    --with-glpk \
                    --with-curl \
                    --with-lapack \
                    --with-umfpack \
                    --with-colamd \
                    --with-ccolamd \
                    --with-cholmod \
                    --with-cxsparse

configure.perl      ${prefix}/bin/perl
configure.python    ' '
configure.awk       ${prefix}/bin/gawk

configure.env-append SED="${prefix}/bin/gsed" \
                    MAKEINFO="${prefix}/bin/makeinfo" \
                    TEXI2DVI="${prefix}/bin/texi2dvi" \
                    TEXI2PDF="${prefix}/bin/texi2pdf"

use_parallel_build  yes

test.run            yes
test.target         check

variant gcc43 description {builds with the macports gcc43 toolchain} {
    depends_lib-append  port:gcc43
    configure.compiler  macports-gcc-4.3
}

if {![variant_isset gcc43]} {
    depends_lib-append  port:g95
    configure.f77       "${prefix}/bin/g95"
}

post-patch {
    reinplace "s|-lcholmod|-lcholmod -lmetis|g" ${worksrcpath}/configure
}

livecheck.check     regex
livecheck.url       http://www.gnu.org/software/octave/news.html
livecheck.regex     Version (\\d+(\\.\\d+)*)
