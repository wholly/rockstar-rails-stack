--- configure.orig	2007-08-03 21:57:47.000000000 -0700
+++ configure	2007-08-03 22:32:29.000000000 -0700
@@ -164,32 +164,14 @@
   esac
 fi
 
-SHAREDLIB=${SHAREDLIB-"libz$shared_ext"}
-SHAREDLIBV=${SHAREDLIBV-"libz$shared_ext.$VER"}
-SHAREDLIBM=${SHAREDLIBM-"libz$shared_ext.$VER1"}
-
-if test $shared -eq 1; then
-  echo Checking for shared library support...
-  # we must test in two steps (cc then ld), required at least on SunOS 4.x
-  if test "`($CC -c $SFLAGS $test.c) 2>&1`" = "" &&
-     test "`($LDSHARED -o $test$shared_ext $test.o) 2>&1`" = ""; then
-    CFLAGS="$SFLAGS"
-    LIBS="$SHAREDLIBV"
-    echo Building shared library $SHAREDLIBV with $CC.
-  elif test -z "$old_cc" -a -z "$old_cflags"; then
-    echo No shared library support.
-    shared=0;
-  else
-    echo 'No shared library support; try without defining CC and CFLAGS'
-    shared=0;
-  fi
-fi
-if test $shared -eq 0; then
-  LDSHARED="$CC"
-  echo Building static library $LIBS version $VER with $CC.
-else
-  LDFLAGS="-L. ${SHAREDLIBV}"
-fi
+shared_ext='.dylib'
+SHAREDLIB=libz$shared_ext
+SHAREDLIBV=libz.$VER$shared_ext
+SHAREDLIBM=libz.$VER1$shared_ext
+LDSHARED="$cc -dynamiclib"
+
+CFLAGS="$SFLAGS"
+LIBS="$SHAREDLIBV"
 
 cat > $test.c <<EOF
 #include <unistd.h>
