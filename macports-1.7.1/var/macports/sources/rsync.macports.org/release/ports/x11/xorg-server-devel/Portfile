# $Id: Portfile 49539 2009-04-12 00:43:59Z jeremyhu@macports.org $

PortSystem 1.0

name		xorg-server-devel
set my_name	xorg-server
version		1.5.3-apple6
categories	x11 devel
maintainers	jeremyhu openmaintainer
description	The X.org / Xquartz X server.
homepage	http://www.x.org
platforms	darwin macosx
long_description The X.org X server allows you to run X11 applications on your computer.
master_sites	http://xquartz.macosforge.org/downloads/src

dist_subdir     ${my_name}
distname        ${my_name}-${version}

checksums           md5     eae7381e413da91abf41fa0c1154f3bb \
                    sha1    bd9e82f44f2b1f34e7b086a258819d86d70d558b \
                    rmd160  661f36f13ce817d4496c0de2b5013e87ccd97d46

use_bzip2	yes
use_parallel_build yes

# Yes, mesa is a *BUILD* dependency
depends_build \
	port:pkgconfig \
	port:mesa \
	port:xorg-applewmproto \
	port:xorg-damageproto \
	port:xorg-evieproto \
	port:xorg-fixesproto \
	port:xorg-fontsproto \
	port:xorg-glproto \
	port:xorg-inputproto \
	port:xorg-randrproto \
	port:xorg-recordproto \
	port:xorg-renderproto \
	port:xorg-resourceproto \
	port:xorg-trapproto \
	port:xorg-scrnsaverproto \
	port:xorg-videoproto \
	port:xorg-xcmiscproto \
	port:xorg-xproto \
	port:xorg-xextproto \
	port:xorg-xineramaproto \
	port:xorg-xtrans

# This xinit dependency needs to be port: not bin: because we specifically run ${prefix}/bin/startx from bundle-main.c
depends_run \
	port:xinit \
	port:xorg-fonts

depends_lib \
	port:libpixman \
	port:xorg-libxkbfile \
	port:xorg-libXfont \
	port:xorg-libXt \
	port:xorg-libAppleWM \
	port:xorg-libXfixes

post-patch {
	reinplace "s|ensure_path(X11BINDIR);|ensure_path(X11BINDIR); ensure_path(\"${x11prefix}/bin\");|" ${worksrcpath}/hw/xquartz/mach-startup/bundle-main.c
}

configure.args	--with-apple-applications-dir=${applications_dir} --with-fontdir=${prefix}/share/fonts --with-apple-application-id=org.macports.X11

# Xplugin.h is missing on Tiger, and provided in filespath
# GL/internal/dri_interface.h is also missing in general (provided by libdrm for the xorg DDX... not helpful for us)
configure.cppflags-append -I/usr/include -I${filespath}/include

post-destroot {
	ln -s Xquartz ${destroot}${prefix}/bin/X
}
