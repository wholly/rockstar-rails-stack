# $Id: Portfile 40000 2008-09-16 16:53:06Z jwa@macports.org $

PortSystem        1.0

name              slony1
version           1.2.15
categories        databases
platforms         darwin
maintainers       wreese@gmail.com jwa
description       A replication system for PostgreSQL
long_description  Slony-I is a trigger-based master to multiple slaves replication system for PostgreSQL being developed by Jan Wieck.
homepage          http://main.slony.info/
master_sites      ${homepage}/downloads/1.2/source
use_bzip2         yes
checksums	  md5 2fa0391eddb2b052d071287ffd301d6b \
    sha1 cc0f5e5d904070a2496a66fe9482c2fdbdda372c \
    rmd160 c99a862bda6aca8adf7f838a872fc66eac556732
depends_lib	  port:postgresql83

configure.args	  --with-pgconfigdir="${prefix}/lib/postgresql83/bin/" \
    --with-pgsharedir="${prefix}/share/postgresql83/" \
    --with-pgbindir="${prefix}/lib/postgresql83/bin/" \
    --with-pgincludedir="${prefix}/include/postgresql83/" \
    --with-pgincludeserverdir="${prefix}/include/postgresql83/server/" \
    --with-pglibdir="${prefix}/lib/postgresql83/" \
    --with-pgpkglibdir="${prefix}/lib/postgresql83/"

destroot.args     -B

variant postgresql82 description {support for PostgreSQL 8.2 instead of 8.3} {
    depends_lib-delete	port:postgresql83
    depends_lib-append	port:postgresql82
    configure.args-delete	--with-pgconfigdir="${prefix}/lib/postgresql83/bin/"
    configure.args-delete	--with-pgsharedir="${prefix}/share/postgresql83/"
    configure.args-delete	--with-pgbindir="${prefix}/lib/postgresql83/bin/"
    configure.args-delete	--with-pgincludedir="${prefix}/include/postgresql83/"
    configure.args-delete	--with-pgincludeserverdir="${prefix}/include/postgresql83/server/"
    configure.args-delete	--with-pglibdir="${prefix}/lib/postgresql83/"
    configure.args-delete	--with-pgpkglibdir="${prefix}/lib/postgresql83/"

    configure.args-append	  --with-pgconfigdir="${prefix}/lib/postgresql82/bin/" \
	--with-pgsharedir="${prefix}/share/postgresql82/" \
	--with-pgbindir="${prefix}/lib/postgresql82/bin/" \
	--with-pgincludedir="${prefix}/include/postgresql82/" \
	--with-pgincludeserverdir="${prefix}/include/postgresql82/server/" \
	--with-pglibdir="${prefix}/lib/postgresql82/" \
	--with-pgpkglibdir="${prefix}/lib/postgresql82/"
}
#post-destroot {
#    foreach bin { slon slonik } {
#	system "cd ${destroot}${prefix}/bin && ln -s ../lib/postgresql82/bin/${bin}"
#	ln -s ${destroot}${prefix}/lib/postgresql82/bin/${bin} ${destroot}${prefix}/bin
#    }
#}

livecheck.check	regex
livecheck.url	${homepage}
livecheck.regex	(1\.2\.\[0-9\]+) (released|available)
