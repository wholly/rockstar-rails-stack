# $Id: Portfile 48484 2009-03-23 15:25:29Z nox@macports.org $

PortSystem      1.0
PortGroup       muniversal 1.0

name            gsed
set my_name     sed
version         4.1.5
revision        4
categories      textproc
platforms       darwin
maintainers     nox openmaintainer
description     GNU version of the stream editor, sed

long_description \
    Sed (streams editor) isn't really a true text editor or text \
    processor. Instead, it is used to filter text, i.e., it takes text \
    input and performs some operation (or set of operations) on it and \
    outputs the modified text. Sed is typically used for extracting part \
    of a file using pattern matching or substituting multiple occurrences \
    of a string within a file.

homepage        http://www.gnu.org/software/${my_name}/
master_sites    gnu:${my_name}
distname        ${my_name}-${version}

checksums       md5 7a1cbbbb3341287308e140bd4834c3ba \
                sha1 8e575e8a44568392d5b6e089eab5da5cdbd45885 \
                rmd160 49b12e99a55c6d2e78ad236f0205e63e46444173

depends_lib     port:gettext \
                port:libiconv

patchfiles      patch-configure.diff

configure.args  --infodir=${prefix}/share/info \
                --mandir=${prefix}/share/man \
                --program-prefix=g

use_parallel_build  yes

set docdir      ${prefix}/share/doc/${my_name}-${version}

post-destroot {
    foreach i [glob -tails -directory ${destroot}${prefix}/share/info *.info*] {
        move ${destroot}${prefix}/share/info/${i} ${destroot}${prefix}/share/info/g${i}
    }

    xinstall -d ${destroot}${docdir}
    xinstall -m 0644 -W ${worksrcpath} AUTHORS BUGS COPYING ChangeLog NEWS README THANKS \
        ${destroot}${docdir}
}

test.run        yes
test.target     check

platform darwin 8 {
    # Bad things happen running 64-bit gsed on Tiger. Fine on Leopard.
    # See https://trac.macports.org/ticket/18297.
    set universal_archs_supported {i386 ppc}
}

variant with_default_names description {Install files without 'g' prefix} {
    post-destroot {
        foreach {d} {bin share/info share/man/man1} {
            foreach {f} [glob -tails -directory ${destroot}${prefix}/${d} g*] {
                ln -sf ${prefix}/${d}/${f} ${destroot}${prefix}/${d}/[string range ${f} 1 end]
            }
        }
    }
}
