# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 48920 2009-03-31 11:28:38Z ryandesign@macports.org $

PortSystem          1.0

name                lilypond
version             2.12.1
categories          textproc
maintainers         snc openmaintainer
description         An automated engraving system for typesetting sheet music.
long_description    Lilypond is a unix-based automated engraving system that \
                    generates beautiful sheet music from input files. Lilypond \
                    uses its own input format, .ly, which in many ways is \
                    similar to LaTeX. Lilypond can export sheet music to PDF, \
                    EPS, SVG, and PNG formats, and can also create MIDI files.

homepage            http://lilypond.org/
platforms           darwin
master_sites        http://download.linuxaudio.org/lilypond/sources/v2.12/
checksums           md5 487d62b20d14faea3edc7561dece3ff2 \
                    sha1 203bead967f8409dbac00fd835d2a411694f408b \
                    rmd160 794c9d8de513ba6e32304883a62b9b368a316030

depends_lib         port:fontforge \
                    port:ghostscript \
                    port:mftrace \
                    port:guile \
                    port:texinfo \
                    port:pango \
                    port:flex \
                    port:urw-fonts

pre-build {
    # we need to help the system find the requisite libraries
    # set the DYLD_LIBRARY_PATH environment variable
    global env
    set env(DYLD_LIBRARY_PATH) /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/Resources:/opt/local/lib

            # create symlinks
    if { [file exists "/usr/lib/libguile-srfi-srfi-1-v-3.so"] == 0 } \
        { ln -s ${prefix}/lib/libguile-srfi-srfi-1-v-3.so /usr/lib/libguile-srfi-srfi-1-v-3.so }
    if { [file exists "${prefix}/lib/libguile-srfi-srfi-1-v-3.so"] == 0 } \
        { ln -s ${prefix}/lib/libguile-srfi-srfi-1-v-3.dylib ${prefix}/lib/libguile-srfi-srfi-1-v-3.so }
}

configure.args  --with-ncsb-dir=${prefix}/share/fonts/urw-fonts \
    --disable-documentation \
    --disable-gui

variant docs description {Build documentation files} {
    configure.args-delete   --disable-documentation
    configure.args-append   --enable-documentation
    depends_lib-append      port:netpbm
}

variant gui description {Build GNOME GUI (X11)} {
    configure.args-delete   --disable-gui
    configure.args-append   --enable-gui
}

default_variants    +docs -gui
