# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 44380 2008-12-27 12:29:17Z jmr@macports.org $

PortSystem 1.0
PortGroup python26 1.0

name            py26-game
version         1.8.1
revision        1
categories      python devel multimedia graphics
platforms       darwin
maintainers     jmr openmaintainer
description     Python modules for writing games
long_description    Pygame is a set of Python modules designed for \
            writing games. It is written on top of the excellent \
            SDL library. This allows you to create fully featured \
            games and multimedia programs in the python language. \
            Pygame is highly portable and runs on nearly every \
            platform and operating system.
homepage        http://www.pygame.org/

master_sites    ${homepage}ftp/
distname        pygame-${version}release
checksums       md5 3e72f11d99c1a46ed69eb943c9de20a5 \
                sha1 62d2ad452a0cc1486f877d5a2ae736b6703548cc \
                rmd160 dc3374e2185a3fbc36cc74ac3b050e7e57f0a4ce

patchfiles      patch-config_darwin.py.diff

depends_lib-append     port:libsdl \
                port:libsdl_mixer \
                port:libsdl_image \
                port:libsdl_ttf \
                port:smpeg \
                port:py26-numeric \
                port:py26-pyobjc

post-extract {
    # See #17749
    system "chmod -R a+r ${worksrcpath}"
    fs-traverse f ${worksrcpath} {
        if {[file isdirectory ${f}]} {
            system "chmod a+rx ${f}"
        }
    }
}

use_configure   yes

configure.env-append LOCALBASE=${prefix}
configure.cmd   ${python.bin} config.py

post-configure {
    # Make sure the X11 include directory is found.
    reinplace "s|-Ddarwin  -lSDL|-Ddarwin -lSDL -I${x11prefix}/include|g" \
        ${worksrcpath}/Setup
}

platform darwin 9 {
    depends_lib-delete port:py26-pyobjc
    depends_lib-append port:py26-pyobjc2 port:py26-pyobjc2-cocoa
}

post-destroot   {
    delete ${destroot}${prefix}/share/doc/${name}/examples
    eval copy [glob ${worksrcpath}/docs/*] ${destroot}${prefix}/share/doc/${name}
    copy ${worksrcpath}/examples ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 -W ${worksrcpath} install.html WHATSNEW \
        README.txt ${destroot}${prefix}/share/doc/${name}
}

livecheck.check regex
livecheck.url   ${homepage}download.shtml
livecheck.regex {<a href=".*/ftp/pygame\-([0-9\.]+)release\.tar\.gz">}
