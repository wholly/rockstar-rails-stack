# $Id: Portfile 49257 2009-04-06 07:56:58Z blb@macports.org $

PortSystem	1.0

name		gnupg2
version		2.0.11
categories	mail security
maintainers	waqar@macports.org boeyms
description	GNU pretty-good-privacy package
long_description	\
	GnuPG is a complete and free replacement for PGP. Because 	\
	it does not use the patented IDEA algorithm, it can be used 	\
	without any restrictions. GnuPG is a RFC2440 (OpenPGP) 		\
	compliant application.
homepage	http://www.gnupg.org
platforms	darwin freebsd sunos
use_bzip2   yes
distname    gnupg-${version}
master_sites    gnupg:gnupg

use_bzip2	yes
checksums   md5     a3014f3b3c919662278060f9a4818b89 \
            sha1    9f71a342c5be686b0dcef082078af693802a558f \
            rmd160  f532a2c41a4fdcf9bd5130f8d382348f6774ba18

post-patch {
    reinplace "s|/var|${prefix}/var|" \
        ${worksrcpath}/sm/call-dirmngr.c
}

# gpg-agent is built separately from the rest of gnupg2 to enable gnupg 1.x
# users to use gpg-agent as well.  gnupg2, however, requires gpg-agent to run,
# and so gnupg2 depends on gpg-agent.

configure.args	--disable-agent

depends_lib	port:libiconv 		\
		port:gettext 		\
		port:zlib 		\
		port:bzip2 		\
		port:bison		\
		port:gpg-agent		\
		port:libassuan		\
		port:libksba		\
		port:libgcrypt		\
		port:libgpg-error	\
		port:pth		\
		port:libusb

patchfiles	patch-configure.diff

test.run	yes
test.dir	${worksrcpath}/tests
test.target 	check

platform darwin {
	configure.env-append	MACOSX_DEPLOYMENT_TARGET=10.3
	build.env-append	MACOSX_DEPLOYMENT_TARGET=10.3
}

platform darwin 7 {
	configure.ldflags-append	"-framework IOKit"
}

# See also the post-patch above.
# Apparently we have no way of forcing gnupg2 to build without DirMngr support,
# so we have to just hope we don't run into any problems.
variant dirmngr description {Enable the use of DirMngr by gpgsm} {
	depends_lib-append  port:dirmngr
}

livecheck.check regex
livecheck.url   http://mirrors.rootmode.com/ftp.gnupg.org/gnupg/?O=D
livecheck.regex gnupg-(\\d+\\.\\d+\\.\\d+)
