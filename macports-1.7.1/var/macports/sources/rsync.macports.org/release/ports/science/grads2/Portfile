# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 48920 2009-03-31 11:28:38Z ryandesign@macports.org $

PortSystem 1.0

name               grads2
version            2.0.a4.oga.1
platforms          darwin
maintainers        takeshi@macports.org
categories         science
description        interactive visualization tool for earth science data
master_sites       sourceforge:opengrads
distname           grads-${version}-src
worksrcdir         grads-${version}
checksums          md5    e3f8e7fd7f54bf817516014b859fb629         \
                   sha1   72d5a8b784cee0f7d8dfaa17ed32275ce6c1d57a \
                   rmd160 cbb994b8852fa72c67eb0a1c8568dfa1beabf6b8
homepage           http://www.opengrads.org/
long_description   \
    The Grid Analysis and Display System (GrADS) is an interactive     \
    desktop tool that is used for easy access, manipulation, and       \
    visualization of earth science data. The format of the data may    \
    be either binary, GRIB, NetCDF, or HDF-SDS (Scientific Data Sets). \
    GrADS has been implemented worldwide on a variety of commonly used \
    operating systems and is freely distributed over the Internet.

depends_build      port:libwww port:readline  port:rx   port:zlib   \
                   port:netcdf port:udunits   port:hdf4 port:wgrib2 \
                   port:libdap port:libnc-dap port:gadap port:pkgconfig

patchfiles         patch-configure.diff 

configure.env-append SUPPLIBS=${prefix} PKG_CONFIG=${prefix}/bin/pkg-config
configure.args     --enable-dyn-supplibs --with-readline         \
                   --with-nc --with-dap --with-hdf --with-x      \
                   --without-printim --without-gui --program-suffix="-2"

pre-build {
  reinplace "s|libwww.a|libwwwcore.a|g" ${worksrcpath}/src/Makefile
  reinplace "s|\$(supp_lib_dir)/inst.o| |g" ${worksrcpath}/src/Makefile
}

test.run    yes
test.target check

post-destroot {
    xinstall -d -m 755 ${destroot}${prefix}/share/${name}
    eval xinstall -m 644 [glob -directory ${worksrcpath}/data *.dat *res] \
                  ${destroot}${prefix}/share/${name}
    xinstall -d -m 755 ${destroot}${prefix}/share/${name}/tables
    eval xinstall -m 644 [glob -directory ${worksrcpath}/data/tables *] \
                  ${destroot}${prefix}/share/${name}/tables
}

variant printim description {image output using GD} {
    depends_build-append    port:jpeg port:libpng port:gd2 port:libwmf
    configure.args-delete   --without-printim
    configure.args-append   --with-printim
}

#variant gui description {enables GUI} {
#    configure.args-delete   --without-gui
#    configure.args-append   --with-gui
#}
