# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 46530 2009-02-06 10:53:44Z takeshi@macports.org $

PortSystem       1.0

name             gmt
version          4.3.1
categories       science
maintainers      takeshi@macports.org
description      the generic mapping tools
long_description an open source collection of ~60 tools         \
    for manipulating geographic and Cartesian data sets and     \
    producing Encapsulated PostScript File (EPS) illustrations  \
    ranging from simple x-y plots via contour maps to           \
    artificially illuminated surfaces and 3-D perspective views.
homepage         http://gmt.soest.hawaii.edu/
platforms        darwin
master_sites     ftp://ftp.soest.hawaii.edu/gmt          \
                 ftp://ibis.grdl.noaa.gov/pub/gmt        \
                 ftp://ftp.iris.washington.edu/pub/gmt   \
                 ftp://ftp.iag.usp.br/pub/gmt            \
                 ftp://ftp.geologi.uio.no/pub/gmt        \
                 ftp://gd.tuwien.ac.at/pub/gmt           \
                 ftp://ftp.scc.u-tokai.ac.jp/pub/gmt     \
                 ftp://mirror.geosci.usyd.edu.au/pub/gmt \
                 ftp://gmt.mirror.ac.za/pub/gmt
use_bzip2        yes
set gshhsversion 1.10
set gmtsrc       GMT${version}_src.tar.bz2
set gmtshare     GMT${version}_share.tar.bz2
set gmtsuppl     GMT${version}_suppl.tar.bz2
set gshhslow     GSHHS${gshhsversion}_coast.tar.bz2
distfiles  ${gmtsrc} ${gmtshare} ${gmtsuppl} ${gshhslow}
checksums  ${gmtsrc}   md5    43db0e2ab2ee48299832f04da4083cee         \
           ${gmtsrc}   sha1   dda72393b5aa1557fde84911b72b18c959ad6df6 \
           ${gmtsrc}   rmd160 08d1d7bfee17d262a4f287e59a0edfee20603e8f \
           ${gmtshare} md5    f392f35e189e4c27742d23100bbba294         \
           ${gmtshare} sha1   c3b4c64cc2b4ba32380fea0572950c0a04d4a86e \
           ${gmtshare} rmd160 1ada48263e1be499ff9644c2a1a2503518962d56 \
           ${gmtsuppl} md5    c5d522d4b16a3d616898055046f5ecc9         \
           ${gmtsuppl} sha1   e1d4bacbebf238bc31ac96b06e30a25e757920b1 \
           ${gmtsuppl} rmd160 c137a24c63bfc5ba739272faf3a6a8cc61007c95 \
           ${gshhslow} md5    d160db8dc5390731bce42d4e2a55d5e1         \
           ${gshhslow} sha1   4fa3b1130addd9cb357e04f4b1f18b22b87a8405 \
           ${gshhslow} rmd160 a9dd3b1336f31df7f5d3879cb72b0b095c533ef8
depends_lib      port:netcdf
worksrcdir       GMT${version}
configure.args --mandir=${prefix}/share/man --enable-shared --datadir=${prefix}/share/${name} --enable-netcdf=${prefix} --disable-www --disable-mex
destroot.target  install-all
destroot.destdir prefix=${destroot}${prefix}

post-destroot {
  file mkdir ${destroot}${prefix}/share/${name}
  file copy ${workpath}/share/coast ${destroot}${prefix}/share/${name}/
  if {[variant_isset doc]} {
    file mkdir ${destroot}${prefix}/share/doc
    file copy ${worksrcpath}/examples ${destroot}${prefix}/share/${name}/
    file copy ${worksrcpath}/tutorial ${destroot}${prefix}/share/${name}/
    file copy ${worksrcpath}/www/${name} ${destroot}${prefix}/share/doc/
  }
}

if {[variant_isset universal]} {
  configure.universal_args-delete --disable-dependency-tracking
  patch {
    reinplace "s|-dynamiclib|-dynamiclib ${configure.universal_ldflags}|" ${worksrcpath}/configure
 }
}

variant gshhs description \
  {installs high and full resolution GSHHS coast line data} {
  set gshhshigh GSHHS${gshhsversion}_high.tar.bz2
  set gshhsfull GSHHS${gshhsversion}_full.tar.bz2
  distfiles-append ${gshhshigh} ${gshhsfull}
  checksums-append \
           ${gshhshigh} md5    ccf1fe0e5231f3e8e3b64140afb7de8d         \
           ${gshhshigh} sha1   73893d6210b3c1a52fdf706248e70471b319f688 \
           ${gshhshigh} rmd160 b4bc1903f3e51959c6dfb320003f9b783b40ed3c \
           ${gshhsfull} md5    d029e624dfe8d15685779fa9f84ff78e         \
           ${gshhsfull} sha1   95634a5db7debbc92cc7a1bd7117fe00e385bbf3 \
           ${gshhsfull} rmd160 c17059e2b8a4632c2422e9694c947836fe86836e
}

variant doc description {installs documentation, examples and tutorial} {
  set gmtpdf GMT${version}_pdf.tar.bz2
  set gmtweb GMT${version}_web.tar.bz2
  set gmtscr GMT${version}_scripts.tar.bz2
  set gmttut GMT${version}_tut.tar.bz2
  distfiles-append ${gmtpdf} ${gmtweb} ${gmtscr} ${gmttut}
  checksums-append \
           ${gmtpdf}   md5    f972c60b29fb703ec436f71e9b2fa25e         \
           ${gmtpdf}   sha1   85df2455317524b068931a9f326256a09506bff4 \
           ${gmtpdf}   rmd160 10e88866ad324a3965bcf6b9f0b6f2582bfaef43 \
           ${gmtweb}   md5    aeb9e26e9a73c9a4707276092af4d38a         \
           ${gmtweb}   sha1   f1a7b3ad398f9add8377c84e3d321fd15fc74e1f \
           ${gmtweb}   rmd160 09f08ad50969c5d56f70feac339616a697f0e0f3 \
           ${gmtscr}   md5    dec8b190c44faa9dc7a6eb512b9e7fd8         \
           ${gmtscr}   sha1   75af0f8591a7ab4b0c1963f787f79f491b7f42e0 \
           ${gmtscr}   rmd160 557b5675df9538729edf0196104543bf8e18bdc9 \
           ${gmttut}   md5    e0207102ce9fd146a8ec6c70d130b3e7         \
           ${gmttut}   sha1   191411c046172e61f62bd94a381f60b15ab6420d \
           ${gmttut}   rmd160 77292dafbd3eab5816d7062b74f773f9ec4264f4
}

variant octave description {compiles Octave interface} {
  depends_lib-append port:octave
  configure.args-append --enable-octave
  configure.args-delete --disable-mex
}

livecheck.check regex
livecheck.url   http://gmt.soest.hawaii.edu/gmt/gmt_home.html
livecheck.regex {Current version is ([0-9]+.[0-9]+.[0-9]+.)}

