# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 38140 2008-07-08 14:26:53Z takeshi@macports.org $

PortSystem 1.0

name               grads
version            1.9b4
revision           4
platforms          darwin
maintainers        takeshi@macports.org
categories         science
description        interactive visualization tool for earth science data
master_sites       ftp://grads.iges.org/grads/1.9/:src \
                   ftp://grads.iges.org/grads/:data
set gradssrc       ${name}-src-${version}${extract.suffix}
set gradsdata      data.tar.Z
distfiles          ${gradssrc}:src ${gradsdata}:data
checksums          ${gradssrc}  sha1 839e32693602e2695825d4d5a1a8ae7e1672c3a5 \
                   ${gradsdata} sha1 6a3e997868b358ecf71ea618c27ad10f28183f5e
homepage           http://www.iges.org/grads/grads.html
long_description   \
    The Grid Analysis and Display System (GrADS) is an interactive     \
    desktop tool that is used for easy access, manipulation, and       \
    visualization of earth science data. The format of the data may    \
    be either binary, GRIB, NetCDF, or HDF-SDS (Scientific Data Sets). \
    GrADS has been implemented worldwide on a variety of commonly used \
    operating systems and is freely distributed over the Internet.

depends_build      port:libwww port:readline  port:rx   port:zlib \
                   port:netcdf port:udunits   port:hdf4           \
                   port:libdap port:libnc-dap

patchfiles         patch-configure.diff patch-grads.h.diff    \
                   patch-wgrib.c.diff   patch-bufrscan.c.diff \
                   patch-gacfg.c.diff   patch-gxhpng.c.diff

post-patch {
    reinplace "s|/usr/local|${prefix}|" ${worksrcpath}/src/gx.h
}

configure.env SUPPLIBS=${prefix}
configure.args     --with-readline --with-lats \
                   --with-nc --with-dods --with-hdf --with-x      \
                   --without-printim --without-gui

pre-build {
  reinplace "s|libwww.a|libwwwcore.a|g" ${worksrcpath}/src/Makefile
  reinplace "s|\$(supp_lib_dir)/inst.o| |g" ${worksrcpath}/src/Makefile
}

post-destroot {
    xinstall -d -m 755 ${destroot}${prefix}/share/${name}/
    foreach file [glob -directory ${workpath} *.dat *res] {
        file rename ${file} ${destroot}${prefix}/share/${name}/
    }
    system "ln -s ${prefix}/bin/${name}dods ${destroot}${prefix}/bin/${name}"
}

variant printim description {image output using GD} {
    depends_build-append    port:jpeg port:libpng port:gd2 port:libwmf
    configure.args-delete   --without-printim
    configure.args-append   --with-printim
}

#variant gui description {enables GUI} {
#    configure.args-delete   --without-gui
#    configure.args-append   --with-gui
#}
