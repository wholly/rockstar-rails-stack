# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 48920 2009-03-31 11:28:38Z ryandesign@macports.org $

PortSystem 1.0

name               wgrib2
version            1.7.8a
platforms          darwin
maintainers        takeshi@macports.org
categories         science
description        program to read atmospheric data files in GRIB2
master_sites       ftp://ftp.cpc.ncep.noaa.gov/wd51we/wgrib2/
distname           ${name}.tgz.v${version}
extract.suffix     
worksrcdir         grib2/g2clib-1.1.7
checksums          md5    f03b57a00db7322f57a8fcf03247ae65         \
                   sha1   fabecaed787a58b6b1c2a9de87457dcf09ef7216 \
                   rmd160 4c42de54c5c1191ef068b5abfd444fa8243e0e36
homepage           http://www.cpc.noaa.gov/products/wesley/wgrib2/
long_description   \
    wgrib2 is a swiss army knife for grib2 files. \
    GRIB-2 has arrived and has begun replacing the the older standard GRIB-1. \
    GRIB-2 can reduce the file size by up to 80% (NAM, JPEG2000 compression).

depends_lib       port:jasper port:libpng port:netcdf port:zlib

use_configure     no

set cppflags ${configure.cppflags}
if {[variant_isset universal]} {
    set cflags "${configure.cflags} ${configure.universal_cflags}"
    set ldflags "${configure.ldflags} ${configure.universal_ldflags}"
} else {
    set cflags ${configure.cflags}
    set ldflags ${configure.ldflags}
}
build.args        "-f makefile INC=\"${cppflags} ${cflags}\""

post-build  { 
    system "ranlib ${worksrcpath}/libgrib2c.a" 
    system "cd ${worksrcpath}/../wgrib2; \
            make -f makefile ${name} \
            CFLAGS=\"-I../g2clib-1.1.7 ${cppflags} \
                           -I/usr/include ${cflags}      \
                           -DUSE_NETCDF -DUSE_REGEX -DUSE_TIGGE\"  \
            LDFLAGS=\"-L../g2clib-1.1.7 ${ldflags} \
                           -lgrib2c -ljasper -lnetcdf -lpng -lz\" "
}

destroot {
    xinstall -m 755 ${worksrcpath}/grib2.h ${destroot}${prefix}/include
    xinstall -m 755 ${worksrcpath}/libgrib2c.a ${destroot}${prefix}/lib
    xinstall -m 755 ${worksrcpath}/../${name}/${name} ${destroot}${prefix}/bin
}
