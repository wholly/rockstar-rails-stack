# $Id: Portfile 35601 2008-03-30 21:48:21Z afb@macports.org $

PortSystem 1.0

name		mozilla
version		1.7.12
revision	1
categories	www
description	Mozilla browser.
long_description	${description}
homepage	http://www.mozilla.org/products/mozilla1.x/
platforms	darwin
maintainers	nomaintainer
distname	${name}-${version}-source
worksrcdir	${name}
master_sites	ftp://ftp.mozilla.org/pub/mozilla.org/mozilla/releases/mozilla${version}/source/
checksums	md5 f1ad6adbbc0510eb76d352c94c801fac
use_bzip2	yes
depends_build	bin:zip:zip bin:gmake:gmake
depends_lib	bin:libIDL-config-2:libidl lib:libgtk.2:gtk2

configure.args	\
    --enable-default-toolkit=gtk2 \
    --mandir=${prefix}/share/man \
    --enable-macos-target=10.3 \
	--enable-optimize \
	--disable-prebinding \
	--with-pthreads \
	--enable-crypto \
	--disable-freetype2 \
	--disable-debug \
	--enable-application=suite \
	--disable-tests \
	--enable-xft \
	--enable-extensions=all \
	--with-system-jpeg=${prefix} \
	--with-system-zlib=${prefix} \
	--with-system-png=${prefix} \
	--with-system-mng=${prefix} \
	--disable-short-wchar \
	--enable-strip \
	--enable-mathml \
	--enable-xinerama
	
post-configure {
    reinplace "/MOZ_GTK2_LIBS/ s/lpangocairo/lpangox-1.0 -lpangocairo/" \
        ${worksrcpath}/config/autoconf.mk
}

variant nomail {
		configure.args-append  --disable-mailnews
}

variant calendar {
		configure.args-append --enable-calendar
}

variant no_crypto {
		configure.args-delete --enable-crypto
		configure.args-append --disable-crypto
}

# needs to be build on HFS
variant aqua {
		configure.args-delete --enable-default-toolkit=gtk2
		configure.args-append --enable-default-toolkit=mac --enable-prebinding
		
		depends_lib-delete lib:libgtk.2:gtk2
}

patch.pre_args            -p1

platform darwin 8 {
    pre-fetch {
        set fl [open "| gcc --version"]
        set data [read $fl]
        if {[regexp "build 4061" $data]} {
            return -code error "\n\
                Xcode 2.0 has a buggy gcc and won't build mozilla \n\
                Upgrades are available at http://connect.apple.com/"
        }
    }
    patchfiles                292530.aviary_10x.2.patch patch-oiddata.h
}

platform darwin 9 {
    pre-fetch {
        ui_msg "WARNING: Mozilla may not work correctly on Leopard, and may simply crash at launch."
    }
    configure.args-delete     --enable-strip --enable-extensions=all
    configure.args-append     --disable-xprint --disable-strip --disable-strip-libs \
                              --enable-extensions=all,-p3p
    patchfiles                292530.aviary_10x.2.patch patch-oiddata.h \
                              patch-nsprpub_pr_include_md__pth.h.diff
}
