# $Id: Portfile 48693 2009-03-27 07:53:06Z ryandesign@macports.org $

PortSystem              1.0

name                    curl-ca-bundle
# keep the version in sync with the curl port
version                 7.19.4
set curl_name           curl
categories              net
maintainers             ryandesign
homepage                http://curl.haxx.se/
platforms               darwin freebsd
use_bzip2               yes
use_parallel_build      no
use_configure           no
universal_variant       no
distname                ${curl_name}-${version}
dist_subdir             ${curl_name}
set curl_source         ${distname}${extract.suffix}
set certdata_file       certdata.txt
set certdata_version    1.51
set certdata_date       2009-01-15
set certdata_distfile   certdata-${certdata_version}.txt
set certdata_path       security/nss/lib/ckfw/builtins/${certdata_file}
build.target            ca-bundle
extract.only            ${curl_source}
extract.post_args-append ${worksrcdir}/Makefile ${worksrcdir}/lib/mk-ca-bundle.pl

description \
    CA certificate bundle for curl

long_description \
    Installs a bundle of certification authority certificates (CA certs) \
    which curl (when linked with OpenSSL) uses to verify the authenticity \
    of secure web and FTP servers.

# keep the master_sites in sync with the curl port
master_sites \
    http://curl.haxx.se/download/ \
    ftp://ftp.sunet.se/pub/www/utilities/curl/ \
    http://curl.sourceforge.net/download/ \
    http://cool.haxx.se/curl/ \
    ftp://gd.tuwien.ac.at/utils/archivers/curl/ \
    http://gd.tuwien.ac.at/utils/archivers/curl/ \
    http://www.execve.net/curl/ \
    http://mxr.mozilla.org/seamonkey/source/${certdata_path}?raw=1:certdata

distfiles \
    ${curl_source} \
    ${certdata_distfile}:certdata

checksums \
    ${curl_source} \
        md5     2734167c1e5f7ce6be99b75d2d371d85 \
        sha1    6b8cb206990cd68d8653cea16a47bd0febd5c50d \
        rmd160  91f46c421e0f23f268640d39f45a74621e951245 \
    ${certdata_distfile} \
        md5     6740714036868bfaa813a88142821f55 \
        sha1    f86e32b114e71b30a7e77aefe460bcc6212ffae1 \
        rmd160  7868d653c5aba32086629110be2cd34b27e44263

depends_build \
    path:bin/perl:perl5

patchfiles \
    patch-no-autodownload.diff

post-extract {
    xinstall ${distpath}/${certdata_distfile} ${worksrcpath}/${certdata_file}
}

destroot {
    set ca_bundle_dir ${destroot}${prefix}/share/curl
    xinstall -d ${ca_bundle_dir}
    xinstall ${worksrcpath}/lib/ca-bundle.crt ${ca_bundle_dir}/curl-ca-bundle.crt
}

livecheck.check         regex
livecheck.url           http://bonsai.mozilla.org/cvsquery.cgi?file=mozilla/${certdata_path}&date=explicit&mindate=${certdata_date}
livecheck.version       ${certdata_version}
livecheck.regex         '${certdata_file}','(\[0-9.\]+)'
