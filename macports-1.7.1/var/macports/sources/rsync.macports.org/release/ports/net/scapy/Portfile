# $Id: Portfile 32393 2007-12-28 23:44:58Z pmq@macports.org $

PortSystem	      1.0
PortGroup	      python24 1.0

name		      scapy
version		      1.2.0.2
categories	      net security python
platforms	      darwin
maintainers	      pmq

description	      A powerful packet manipulation tool
long_description      \
        Scapy is a powerful interactive packet manipulation program. It is \
        able to forge or decode packets of a wide number of protocols, send \
        them on the wire, capture them, match requests and replies, and much \
        more. It can easily handle most classical tasks like scanning, \
        tracerouting, probing, unit tests, attacks or network discovery (it \
        can replace hping, 85% of nmap, arpspoof, arp-sk, arping, tcpdump, \
        tethereal, p0f, etc.). It also performs very well at a lot of other \
        specific tasks that most other tools can't handle, like sending \
        invalid frames, injecting your own 802.11 frames, combining technics \
        (VLAN hopping+ARP cache poisoning, VOIP decoding on WEP encrypted \
        channel, ...), etc.

homepage	      http://www.secdev.org/projects/scapy
set hg_revision	      d9c79a8bc874
master_sites	      ${homepage}/files:files \
		      http://hg.secdev.org/${name}/raw-file/${hg_revision}:code

distfiles	      ${name}.py:code ethertypes:files
checksums	      ${name}.py \
		          sha1 212aee3be0647d3402560e3bf81c523df1f780d1 \
                      	  rmd160 6911b7f2cc8353c4e577c57c711dbdcabf4e412a \
		      ethertypes \
		          sha1 6ed0fe2446666876d77b8971fd8edf495a9c0be3 \
			  rmd160 296b88fed911b25398b5f657cd6bb5c91e72e288

depends_lib-append    port:py-readline port:py-pylibpcap port:py-libdnet \
		      port:py-crypto port:py-gnuplot port:py-pyx port:graphviz

extract {
    xinstall -d ${worksrcpath}
    file copy ${distpath}/${name}.py ${worksrcpath}/${name}.py
}

use_configure	      no

build {
    # force using the MacPorts-provided Python, with the correct version
    reinplace "s|/usr/bin/env python|${python.bin}|" ${worksrcpath}/${name}.py

    # load sensible defaults in case the user has installed other network apps
    reinplace "s|/etc/ethertypes|${prefix}/etc/ethertypes|" ${worksrcpath}/${name}.py
    reinplace "s|/etc/p0f|${prefix}/share/p0f|" ${worksrcpath}/${name}.py
    reinplace "s|/usr/share/nmap|${prefix}/share/nmap|" ${worksrcpath}/${name}.py
    reinplace "s|/usr/share/wireshark/wireshark|${prefix}/share/wireshark|" \
        ${worksrcpath}/${name}.py
    # there's no queso port, not altering the default queso.conf path
    # use Preview.app to view PDF and PS files
    set call_preview "open -a Preview"
    reinplace "s|\"acroread\"|\"${call_preview}\"|" ${worksrcpath}/${name}.py
    reinplace "s|\"gv\"|\"${call_preview}\"|" ${worksrcpath}/${name}.py
}

destroot  {
    xinstall -m 755 -W ${worksrcpath} scapy.py ${destroot}${prefix}/bin
    xinstall -m 644 -W ${distpath} ethertypes ${destroot}${prefix}/etc
    # xinstall -m 644 -W ${worksrcpath} scapy.1 ${destroot}${prefix}/share/man/man1

    # changelog.txt seems obsolete
    # xinstall -d ${destroot}${prefix}/share/doc/${name}
    # xinstall -m 644 AUTHORS COPYING README changelog ${destroot}${prefix}/share/doc/${name}
}
