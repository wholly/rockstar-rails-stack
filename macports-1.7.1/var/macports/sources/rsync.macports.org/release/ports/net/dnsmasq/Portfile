# $Id: Portfile 39895 2008-09-10 21:33:39Z ryandesign@macports.org $

PortSystem 1.0

name		dnsmasq
version		2.45
categories	net
platforms	darwin
maintainers	nomaintainer
description	lightweight DNS forwarder and DHCP server
long_description	Dnsmasq is lightweight, easy to configure DNS \
			forwarder and DHCP server. It is designed to provide \
			DNS and, optionally, DHCP, to a small network. It can \
			serve the names of local machines which are not in the \
			global DNS. The DHCP server integrates with the DNS \
			server and allows machines with DHCP-allocated \
			addresses to appear in the DNS with names configured \
			either in each host or in a central configuration \
			file. Dnsmasq supports static and dynamic DHCP leases \
			and BOOTP for network booting of diskless machines.
homepage	http://www.thekelleys.org.uk/dnsmasq/doc.html
master_sites	http://www.thekelleys.org.uk/dnsmasq/
checksums	sha1 12f8cffd657f674fbf4bf4f670a0dcb65ea4a5ae
patchfiles	patch-config.h.diff patch-Makefile.diff

configure	{
	reinplace "s|__PREFIX__|${prefix}|g" ${worksrcpath}/src/config.h
}

destroot.args	PREFIX=${prefix}
destroot.keepdirs   ${destroot}${prefix}/var/run

platform darwin 8 {
	build.args-append CC=/usr/bin/gcc-4.0
}

post-activate {
	# Make sure initial conf files are present and setup correctly
	if {![file exists ${prefix}/etc/dnsmasq.conf]} {
			file copy ${prefix}/etc/dnsmasq.conf.sample \
				${prefix}/etc/dnsmasq.conf
	  }
}


startupitem.create	yes
startupitem.name	dnsmasq
startupitem.executable	${prefix}/sbin/dnsmasq -k
