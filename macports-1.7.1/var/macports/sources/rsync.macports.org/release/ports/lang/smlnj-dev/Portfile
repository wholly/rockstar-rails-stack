# $Id: Portfile 31328 2007-11-20 05:10:00Z bfulgham@macports.org $

PortSystem 1.0
name             smlnj-dev
version          110.65
categories       lang ml
maintainers      bfulgham@macports.org
description      Standard ML of New Jersey (Development Branch)
long_description \
	Standard ML of New Jersey (abbreviated SML/NJ) is a \
	compiler for the Standard ML '97 programming language \
	with associated libraries, tools, and documentation. \
	SML/NJ is free, open source software.
homepage         http://www.smlnj.org/
platforms        darwin

set svn_site     svn://smlnj-gforge.cs.uchicago.edu/smlnj

fetch {
	system "cd ${workpath} && svn co ${svn_site}/admin"
	system "cd ${workpath} && admin/checkout-all.sh smlnj"
}

post-fetch {
	touch ${workpath}/smlnj/ml-yacc/src/yacc.grm.sig
	touch ${workpath}/smlnj/ml-yacc/src/yacc.grm.sml
}

extract  {
	system "mv ${workpath}/smlnj ${workpath}/${name}-${version}"
}

checksum { }
configure {}


### build ###
build.cmd            ${worksrcpath}/config/install.sh
build.target

### destroot ###
destroot {
	set smlnj_home ${prefix}/share/${name}

	file mkdir ${destroot}${smlnj_home}
	file copy ${worksrcpath}/bin ${destroot}${smlnj_home}
	file copy ${worksrcpath}/lib ${destroot}${smlnj_home}

	# Create an alias for sml (to sml-dev) so you can install sml-dev
	# and sml side-by-side.
	system "cd ${destroot}${smlnj_home}/bin && ln -s sml sml-dev"

	xinstall -m 555 ${filespath}/sml-dev.sh ${destroot}${prefix}/bin/sml-dev
	reinplace "s|__SMLNJ_HOME__|${smlnj_home}|g" \
		${destroot}${prefix}/bin/sml-dev

	foreach prog [glob -directory ${worksrcpath}/bin *] {
		set progname [file tail $prog]
		if {![string equal $progname sml-dev]} {
			system "ln -s sml-dev ${destroot}${prefix}/bin/${progname}"
		}
	}
}
